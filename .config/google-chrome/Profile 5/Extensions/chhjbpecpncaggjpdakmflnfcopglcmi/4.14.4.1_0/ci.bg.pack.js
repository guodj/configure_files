window.AddonsFramework=function(h){var d=this;d.browser=new d.Browser;d.extension=new d.Extension(d,h);d.ui=new function(){this.button=new d.Button;this.settings=new d.Settings(d);this.contextMenu=h&&h.contextMenu&&h.contextMenu.map(function(h){return new d.ContextMenu(h)})}};window.AddonsFramework.prototype.Browser=function(){function h(a){switch(a.tabId||e.CURRENTTAB){case e.NEWTAB:chrome.tabs.create({url:a.url,active:!0});break;case e.BACKGROUNDTAB:chrome.tabs.create({url:a.url,active:!1});break;case e.CURRENTTAB:chrome.tabs.query({active:!0,currentWindow:!0},function(c){0<c.length&&chrome.tabs.update(c[0].id,{url:a.url})});break;case e.NEWWINDOW:chrome.windows.create({url:a.url,active:!0});break;case e.ALLTABS:chrome.windows.getAll({populate:!0},function(c){c.forEach(function(c){c.tabs.forEach(function(c){chrome.tabs.update(c.id,
{url:a.url})})})});break;default:chrome.tabs.get(a.tabId,function(c){!chrome.runtime.lastError&&c?(chrome.tabs.update(a.tabId,{url:a.url}),delete f[a.tabId]):f[a.tabId]=a})}}function d(a,c){g[a]&&g[a].forEach(function(a){a&&a(c)})}function m(a){if(a){var c={action:"event",data:{name:e.TABCHANGED,tabId:a.id,url:a.url}};a.url&&0!=a.url.indexOf("chrome://")&&chrome.tabs.sendMessage(a.id,c);d(e.TABCHANGED,c.data)}}var e=this,g={},f={};e.attachEvent=function(a,c){g[a]||(g[a]=[]);g[a].push(c)};e.detachEvent=
function(a,c){if(g[a])for(var b=g[a].length-1;0<=b;b--)g[a][b]&&c===g[a][b]&&(delete g[a][b],g[a][b]=null,g[a].splice(b,1))};e.navigate=h;e.NEWTAB=-1;e.CURRENTTAB=-2;e.NEWWINDOW=-3;e.ALLTABS=-4;e.TABCLOSED=-5;e.BACKGROUNDTAB=-6;e.DOCUMENTCOMPLETE="DocumentComplete";e.BEFORENAVIGATE="BeforeNavigate";e.TABCHANGED="TabChanged";var l=[],b=navigator.userAgent.match(/.*(opr|yabrowser|mrchrome|chrome|firefox|edge)\/?\s*([\.\d]+)/i);if(b){switch(b[1].toLowerCase()){case "opr":e.name="Opera";break;case "firefox":case "edge":e.name=
b[1];break;default:e.name="Chrome"}e.version=b[2]||"unknown"}else e.name="chromium",e.version="unknown";chrome.tabs.onActivated.addListener(function(a){f[a.tabId]&&h(f[a.tabId]);chrome.tabs.get(a.tabId,function(c){chrome.runtime.lastError||m({url:c&&c.url?c.url:"",id:a.tabId})})});chrome.windows.onFocusChanged.addListener(function(a){a!==chrome.windows.WINDOW_ID_NONE&&chrome.tabs.query({windowId:a,active:!0},function(a){m(a.pop())})});chrome.tabs.onRemoved.addListener(function(a){var c={name:e.TABCLOSED,
tabId:a,url:l[a]&&l[a].url?l[a].url:""};l.splice(a,1);d(e.TABCLOSED,c)});chrome.tabs.onUpdated.addListener(function(a,c){c.url&&(l[a]={},l[a].url=c.url)});chrome.webNavigation.onDOMContentLoaded.addListener(function(a){0===a.frameId&&chrome.tabs.get(a.tabId,function(c){!chrome.runtime.lastError&&c&&c.active&&d(e.DOCUMENTCOMPLETE,{name:e.DOCUMENTCOMPLETE,tabId:a.tabId,url:a.url})})});chrome.webRequest.onBeforeRequest.addListener(function(a){d(e.BEFORENAVIGATE,{name:e.BEFORENAVIGATE,tabId:a.tabId,url:a.url})},
{urls:["<all_urls>"],types:["main_frame"]})};window.AddonsFramework.prototype.Extension=function(h,d){function m(b){chrome.windows.getAll({populate:!0},function(a){a.forEach(function(a){try{a.tabs.forEach(function(a){b(a)})}catch(n){}})})}var e=this,g=window.localStorage.getItem("id"),f={},l=function(b,a){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}({name:null,version:null,description:null,url:null,author:null,optionsPage:null},d);chrome.runtime.onMessage.addListener(function(b,a,c){switch(b.action){case "event":if(a.tab){var d=
b.name,k={name:d,url:a.tab.url||a.url,tabId:a.tab.id,data:b.data?b.data.data:void 0};f[d]&&f[d].forEach(function(a){a.call(e,k,c)})}break;case "ci_browser_navigate":h.browser.navigate(b,a.tab);break;case "ci_extension_getSettings":c({name:e.name,version:e.version,description:e.description,url:e.url,a:e.author})}return!0});chrome.runtime.onMessageExternal&&chrome.runtime.onMessageExternal.addListener(function(b,a,c){if("event"===b.action&&a.id){var d=b.name,k={name:d,url:(a.tab?a.tab.url:"")||a.url,
extensionId:a.id,data:b.data?b.data.data:void 0};a.tab&&(k.tabId=a.tab.id);f[d]&&f[d].forEach(function(a){a.call(e,k,c)})}return!0});this.fireEvent=function(b,a,c){function d(a){return!isNaN(parseInt(a))&&isFinite(a)}var k={action:"event",name:b,data:a};a.extensionId?chrome.runtime.sendMessage(a.extensionId,k,c):a.tabId==h.browser.ALLTABS?m(function(a){chrome.tabs.sendMessage(a.id,k,c)}):d(a.tabId)&&0<=a.tabId?chrome.tabs.sendMessage(a.tabId,k,c):chrome.tabs.query({active:!0,currentWindow:!0},function(a){a&&
a[0]&&a[0].id&&-1===a[0].url.indexOf("chrome://")&&chrome.tabs.sendMessage(a[0].id,k,c)});f[b]&&f[b].forEach(function(b){b.call(e,a,c)})};this.attachEvent=function(b,a){f[b]||(f[b]=[]);f[b].push(a)};this.detachEvent=function(b,a){if(f[b])for(var c=f[b].length-1;0<=c;c--)f[b][c]&&a===f[b][c]&&(delete f[b][c],f[b][c]=null,f[b].splice(c,1))};this.log=function(){console.log.apply(console,arguments)};this.setItem=function(b,a){if("string"==typeof b)if("undefined"==typeof a)chrome.storage.local.remove(b);
else{var c={};c[b]=a;chrome.storage.local.set(c)}else"object"==typeof b&&chrome.storage.local.set(b)};this.getItem=function(b,a){"string"==typeof b||("array"==typeof b||"object"==typeof b)&&0<b.length?chrome.storage.local.get(b,function(c){"string"==typeof b?a(c?c[b]:null):a(c)}):a(null)};this.getId=function(b){b(g)};this.getBackgroundPage=function(){return window};g||(g=function(){function b(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return b()+b()+"-"+b()+"-"+b()+"-"+
b()+"-"+b()+b()+b()}(),localStorage.setItem("id",g),f.Installed&&f.Installed.forEach(function(b){b({id:g})}));(function(){e.__defineGetter__("name",function(){return l.name});e.__defineGetter__("version",function(){return l.version});e.__defineGetter__("description",function(){return l.description});e.__defineGetter__("url",function(){return l.url});e.__defineGetter__("author",function(){return l.author});e.__defineGetter__("optionsPage",function(){return l.optionsPage})})()};window.AddonsFramework.prototype.Button=function(){function h(c){for(var b=0;b<a.length;b++)try{a[b]({tabId:c.id,url:c.url,name:"ButtonClick"})}catch(k){}}var d=null,m=null,e=null,g=null,f=chrome.runtime.getManifest();if(f.page_action){var l=function(a){d.show(a);m&&d.setPopup({tabId:a,popup:m});e&&d.setIcon({tabId:a,path:e});g&&d.setTitle({tabId:a,title:g})},m=f.page_action.default_popup,e=f.page_action.default_icon,g=f.page_action.default_title,d=chrome.pageAction;chrome.tabs.query({active:!0,windowId:chrome.windows.WINDOW_ID_CURRENT},
function(a){d.show(a[0].id)});chrome.tabs.onUpdated.addListener(l);chrome.tabs.onActivated.addListener(function(a){l(a.tabId)})}else f.browser_action&&(d=chrome.browserAction);var b=!1,a=[];this.setPopup=function(a){d&&(m=a?a.url:"",d===chrome.browserAction?d.setPopup({popup:m}):chrome.tabs.query({active:!0,windowId:chrome.windows.WINDOW_ID_CURRENT},function(a){d.setPopup({tabId:a[0].id,popup:m})}))};this.setIcon=function(a){d&&(e=a,d===chrome.browserAction?d.setIcon({path:a}):chrome.tabs.query({active:!0,
windowId:chrome.windows.WINDOW_ID_CURRENT},function(a){d.setIcon({tabId:a[0].id,path:e})}))};this.setTitle=function(a){d&&(g=a,d===chrome.browserAction?d.setTitle({title:g}):chrome.tabs.query({active:!0,windowId:chrome.windows.WINDOW_ID_CURRENT},function(a){d.setTitle({tabId:a[0].id,title:g})}))};this.attachEvent=function(c,e){"ButtonClick"==c&&(b||(d&&d.onClicked.addListener(h),b=!0),a.push(e))};this.detachEvent=function(c,e){if("ButtonClick"==c){for(var k=0;k<a.length;k++)a[k]===e&&(a.splice(k,
1),k--);0==a.length&&(b=!1,d&&d.onClicked.removeListener(h))}};this.setBadgeText=function(a){"string"!==typeof a&&(a=a.toString());d&&d.setBadgeText({text:a.toString()})};this.setBadgeBackgroundColor=function(a){function b(a){var b=/rgb\((\d+), (\d+), (\d+)\)/;if(b.test(a))return a=b.exec(a),[parseInt(a[1]),parseInt(a[2]),parseInt(a[3]),255];a=parseInt(-1<a.indexOf("#")?a.substring(1):a,16);return[a>>16,(a&65280)>>8,a&255,255]}d&&d.setBadgeBackgroundColor({color:b(a)})};this.setBadgeColor=function(){};
this.CLICK="ButtonClick"};window.AddonsFramework.prototype.Settings=function(h){this.open=function(){var d=h.extension.optionsPage;d&&h.browser.navigate({url:d,tabId:h.browser.NEWTAB})}};
